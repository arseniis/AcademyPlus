<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AP TutorConnect - Sign Up</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <style>

    .age-input.invalid {
  border-color: #e74c3c;
  animation: shake 0.5s;
}

    :root {
      --primary-blue: #4a85e8;
      --accent-orange: #ff9900;
      --bg-light: #f5f7fa;
      --text-dark: #2e2e2e;
      --border-radius: 12px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-light);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .container {
      background: white;
      padding: 40px;
      border-radius: var(--border-radius);
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 520px;
      animation: fadeIn 0.6s ease;
    }

    h2 {
      color: var(--primary-blue);
      margin-bottom: 20px;
      text-align: center;
    }

    .input-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-dark);
    }

    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      font-size: 1rem;
      transition: border-color 0.3s;
    }

    input:focus, select:focus {
      border-color: var(--primary-blue);
      outline: none;
    }

    select {
      appearance: none;
      background-color: white;
      background-image: url("data:image/svg+xml;utf8,<svg fill='none' stroke='%234a85e8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M19 9l-7 7-7-7'/></svg>");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1rem;
      padding-right: 2.5rem;
    }

    .invalid {
      border-color: #e74c3c !important;
      animation: shake 0.5s;
    }

    .validation-message {
      margin-top: 4px;
      font-size: 13px;
      color: #e74c3c;
      opacity: 0;
      transition: opacity 0.3s ease;
      height: 16px;
    }

    .validation-message.show {
      opacity: 1;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    button {
      width: 100%;
      padding: 12px;
      background: var(--primary-blue);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #3a6ecc;
    }

    .progress-bar {
      height: 8px;
      background: #ddd;
      border-radius: 10px;
      margin-bottom: 24px;
      overflow: hidden;
    }

    .progress {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-orange));
      transition: width 0.3s ease;
    }

    .hidden {
      display: none;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .continue-button {
      width: 105%;
    }

    #modalOverlay {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 100vw;
      background: rgba(0, 0, 0, 0.3);
      z-index: 999;
      display: none;
    }

    #selectedAps {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
      background: #f9f9f9;
    }

    #selectedAps.hidden {
      display: none;
    }

    #apPlaceholder {
      color: #999;
      font-style: italic;
      margin-top: 15px;
    }

    #apSelectorModal {
      padding-bottom: 80px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      padding: 30px 30px 70px 30px;
      width: 400px;
      max-height: 60vh;
      overflow-y: auto;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
    }

    #confirmApBtn {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 30px;
  width: calc(100% - 100px);
  max-width: 360px;
  background: var(--primary-blue);
  color: white;
  border: none;
  border-radius: 12px;
  padding: 14px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  z-index: 1001;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  transition: background 0.3s ease;
}

#confirmApBtn:hover {
  background: #3a6ecc;
}

    /* #apSelectorModal .confirm-btn {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      width: calc(100% - 100px);
      max-width: 360px;
      background: rgba(74, 133, 232, 0.9); /* glassy */
      /* backdrop-filter: blur(12px);
      border: none;
      color: white;
      border-radius: 12px;
      padding: 14px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 1001;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      transition: background 0.3s ease;
    } */

    /* #apSelectorModal .confirm-btn:hover {
      background: rgba(58, 110, 204, 0.95);
    } */ 

    /* #apSelectorModal::after {
      content: '';
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100px;
      background: linear-gradient(to top, rgba(255, 255, 255, 0.8), transparent);
      backdrop-filter: blur(8px);
      z-index: 1000;
      pointer-events: none;
    } */
    
    input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: var(--primary-blue);
      border-radius: 6px;
      box-shadow: 0 0 1px rgba(0,0,0,0.2);
      cursor: pointer;
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="progress-bar">
      <div class="progress" id="progress"></div>
    </div>

    <div class="first-page" id="step1">
      <h2>Sign Up</h2>
      <div class="input-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="example@domain.com" />
        <div class="validation-message" id="emailError"></div>
      </div>
      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" />
        <div class="validation-message" id="passwordError"></div>
      </div>
      <button class="continue-button" onclick="nextStep(2)">Continue</button>
    </div>

    <div id="step2" class="hidden">
      <h2>Tell Us About You</h2>
      <div class="input-group">
        <label for="firstName">First Name</label>
        <input type="text" id="firstName" placeholder="John" />
        <div class="validation-message" id="firstNameError"></div>
      </div>
      <div class="input-group">
        <label for="lastName">Last Name</label>
        <input type="text" id="lastName" placeholder="Doe" />
        <div class="validation-message" id="lastNameError"></div>
      </div>
      <div class="input-group">
        <label for="ageInput" class="age-input-label">Your Age</label>
        <input 
            type="number" 
            id="ageInput" 
            class="age-input" 
            placeholder="Enter your age (numbers only)"
            min="1"
            max="120"
            step="1"
            inputmode="numeric"
            pattern="\d*"
        />
        <div class="validation-message" id="validationMessage"></div>
        </div>
      <div class="input-group">
        <label for="school">School</label>
        <input type="text" id="school" placeholder="Start typing your school name..." />
        <div class="validation-message" id="schoolError"></div>
      </div>
      <div class="input-group">
        <label for="grade">Grade</label>
        <select id="grade">
          <option value="">Select your grade</option>
          <option value="M3">M3</option>
          <option value="H1">H1</option>
          <option value="H2">H2</option>
          <option value="H3">H3</option>
          <option value="Other">Other</option>
        </select>
        <div class="validation-message" id="gradeError"></div>
      </div>
      <button onclick="submitDetails()">Next</button>
    </div>

    <div id="step3" class="hidden">
      <h2>Select Your APs</h2>
      <div class="input-group" style="display: flex; gap: 10px;">
       <button onclick="toggleApSelector()">Add APs</button>
      </div>
      <div id="selectedAps" class="hidden"></div>
      <div id="apPlaceholder">No APs selected yet.</div>
      <div style="margin-top: 20px;"></div>
      <button onclick="submitAps()">Submit</button>
    </div>
  </div>

  <script>
    const schoolList = ["Hiroo Gakuen", "ASIJ", "YIS", "St. Mary's", "UWC ISAK", "Nishimachi", "Keio", "Waseda", "Columbia International"];
    const schoolInput = document.getElementById('school');

    schoolInput.addEventListener('input', function () {
      const val = this.value;
      closeAllLists();
      if (!val) return false;
      const list = document.createElement("div");
      list.setAttribute("id", this.id + "-autocomplete-list");
      list.setAttribute("class", "autocomplete-items");
      this.parentNode.appendChild(list);

      schoolList.forEach(school => {
        if (school.toLowerCase().includes(val.toLowerCase())) {
          const item = document.createElement("div");
          item.innerHTML = "<strong>" + school.substr(0, val.length) + "</strong>" + school.substr(val.length);
          item.addEventListener("click", function () {
            schoolInput.value = school;
            closeAllLists();
          });
          list.appendChild(item);
        }
      });
    });

    function closeAllLists() {
      const items = document.getElementsByClassName("autocomplete-items");
      for (let i = 0; i < items.length; i++) {
        items[i].parentNode.removeChild(items[i]);
      }
    }

    function nextStep(step) {
      const email = document.getElementById('email');
      const password = document.getElementById('password');
      const emailError = document.getElementById('emailError');
      const passwordError = document.getElementById('passwordError');

      let valid = true;

      if (!email.value.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)) {
        email.classList.add('invalid');
        emailError.textContent = 'Invalid email format';
        emailError.classList.add('show');
        valid = false;
      } else {
        email.classList.remove('invalid');
        emailError.classList.remove('show');
      }

      if (!password.value) {
        password.classList.add('invalid');
        passwordError.textContent = 'Password is required';
        passwordError.classList.add('show');
        valid = false;
      } else {
        password.classList.remove('invalid');
        passwordError.classList.remove('show');
      }

      if (!valid) return;

      localStorage.setItem('userEmail', email.value);
      localStorage.setItem('userPass', password.value);

      document.getElementById('step1').classList.add('hidden');
      document.getElementById('step2').classList.remove('hidden');
      document.getElementById('progress').style.width = '50%';
    }

    function submitDetails() {
      const fields = ['firstName', 'lastName', 'ageInput', 'school', 'grade'];
      let valid = true;

      fields.forEach(id => {
        const input = document.getElementById(id);
        let error;
        if (id === 'ageInput') {
          error = document.getElementById('validationMessage');
        } else {
          error = document.getElementById(id + 'Error');
        }

        if (!input.value) {
          input.classList.add('invalid');
          error.textContent = id === 'ageInput' ? 'Enter a valid age (1-120)' : 'This field is required';
          error.classList.add('show');
          valid = false;
        } else {
          input.classList.remove('invalid');
          error.classList.remove('show');
        }
      });

      if (!valid) return;

      localStorage.setItem('firstName', document.getElementById('firstName').value);
      localStorage.setItem('lastName', document.getElementById('lastName').value);
      localStorage.setItem('age', document.getElementById('ageInput').value);
      localStorage.setItem('school', document.getElementById('school').value);
      localStorage.setItem('grade', document.getElementById('grade').value);

      document.getElementById('step2').classList.add('hidden');
      document.getElementById('step3').classList.remove('hidden');
      document.getElementById('progress').style.width = '100%';
    }

    document.addEventListener('DOMContentLoaded', function () {
  const ageInput = document.getElementById('ageInput');
  const validationMessage = document.getElementById('validationMessage');

  // Real-time filtering and validation
  ageInput.addEventListener('input', function () {
    this.value = this.value.replace(/[^0-9]/g, ''); // remove non-digits
    validateInput();
  });

  ageInput.addEventListener('blur', validateInput);

  function validateInput() {
    const value = ageInput.value;

    if (value.length === 0) {
      ageInput.classList.remove('invalid');
      validationMessage.textContent = '';
      validationMessage.classList.remove('show');
    } else if (!/^\d+$/.test(value)) {
      ageInput.classList.add('invalid');
      validationMessage.textContent = 'Please enter numbers only (0-9)';
      validationMessage.classList.add('show');
    } else if (parseInt(value) < 1) {
      ageInput.classList.add('invalid');
      validationMessage.textContent = 'Age must be at least 1';
      validationMessage.classList.add('show');
    } else if (parseInt(value) > 120) {
      ageInput.classList.add('invalid');
      validationMessage.textContent = 'Please enter a realistic age (1â€“120)';
      validationMessage.classList.add('show');
    } else {
      ageInput.classList.remove('invalid');
      validationMessage.textContent = '';
      validationMessage.classList.remove('show');
    }
  }
    });

    const apSubjects = [
    "AP Biology", "AP Calculus AB", "AP Calculus BC", "AP Chemistry", "AP Computer Science A",
    "AP Computer Science Principles", "AP English Language", "AP English Literature",
    "AP Environmental Science", "AP Human Geography", "AP Macroeconomics", "AP Microeconomics",
    "AP Physics 1", "AP Physics 2", "AP Physics C: Mechanics", "AP Physics C: E&M",
    "AP Psychology", "AP Statistics", "AP US Government", "AP US History", "AP World History"
  ];

  const selectedSubjects = new Set();

  function toggleApSelector() {
  const modal = document.getElementById('apSelectorModal');
  const overlay = document.getElementById('modalOverlay');
  const confirmBtn = document.getElementById('confirmApBtn');
  const apListContainer = document.getElementById('apList');

  const isOpen = modal.style.display === 'block';

  if (isOpen) {
    modal.style.display = 'none';
    overlay.style.display = 'none';
    confirmBtn.style.display = 'none';
  } else {
    modal.style.display = 'block';
    overlay.style.display = 'block';
    confirmBtn.style.display = 'block';

    // Only fill once
    if (apListContainer.children.length === 0) {
      apSubjects.forEach(ap => {
        const wrapper = document.createElement('div');
        wrapper.style.display = 'flex';
        wrapper.style.justifyContent = 'space-between';
        wrapper.style.alignItems = 'center';
        wrapper.style.marginBottom = '12px';
        wrapper.style.padding = '8px 0';
        wrapper.style.borderBottom = '1px solid #eee';

        const label = document.createElement('label');
        label.textContent = ap;
        label.style.flex = 'none';
        label.style.marginRight = '20px';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.value = ap;

        wrapper.appendChild(label);
        wrapper.appendChild(checkbox);
        apListContainer.appendChild(wrapper);
      });
    }
  }
}

  function addSelectedAps() {
  const apList = document.getElementById('apList').querySelectorAll('input[type="checkbox"]:checked');
  let added = false;

  apList.forEach(box => {
    if (!selectedSubjects.has(box.value)) {
      selectedSubjects.add(box.value);
      renderApRow(box.value);
      added = true;
    }
    box.checked = false;
  });

  if (added) {
    document.getElementById('selectedAps').classList.remove('hidden');
    document.getElementById('apPlaceholder').style.display = 'none';
  }

  document.getElementById('confirmApBtn').style.display = 'none';
  toggleApSelector();
}

  function renderApRow(subject) {
    document.getElementById('selectedAps').classList.remove('hidden');

    const row = document.createElement('div');
    row.style.display = 'flex';
    row.style.alignItems = 'center';
    row.style.marginBottom = '12px';
    row.style.gap = '10px';

    const label = document.createElement('div');
    label.textContent = subject;
    label.style.flex = '2';
    label.style.fontWeight = '500';

    const score = document.createElement('select');
    score.innerHTML = '<option value="">Score</option>' +
      [1, 2, 3, 4, 5].map(v => `<option value="${v}">${v}</option>`).join('');
    score.style.flex = '1';

    const year = document.createElement('input');
    year.type = 'number';
    year.placeholder = 'Year';
    year.style.width = '70px';
    year.style.flex = '0.7';

    row.appendChild(label);
    row.appendChild(score);
    row.appendChild(year);

    document.getElementById('selectedAps').appendChild(row);
  }

  function submitAps() {
    const selectedApsDiv = document.getElementById('selectedAps');
    const rows = selectedApsDiv.children;
    const aps = [];

    for (let row of rows) {
      const subject = row.children[0].textContent;
      const score = row.children[1].value;
      const year = row.children[2].value;

      if (!score) {
        alert(`Please enter a score for ${subject}`);
        return; // stop submit if any selected AP is missing score
      }

      aps.push({ subject, score: parseInt(score), year: year || "" });
    }

    if (aps.length === 0) {
      alert("Please select at least one AP and enter a score.");
      return;
    }

    // Save all user info to localStorage
    localStorage.setItem('firstName', document.getElementById('firstName').value);
    localStorage.setItem('lastName', document.getElementById('lastName').value);
    localStorage.setItem('age', document.getElementById('ageInput').value);
    localStorage.setItem('school', document.getElementById('school').value);
    localStorage.setItem('grade', document.getElementById('grade').value);
    localStorage.setItem('userEmail', document.getElementById('email').value);
    localStorage.setItem('userAPs', JSON.stringify(aps));

    // Redirect to tutoring page
    window.location.href = 'Tutoring.html'; // Change this if your tutoring page has a different filename
  }

  </script>

  <div id="modalOverlay" onclick="toggleApSelector()"></div>
  <div id="apSelectorModal">
    <h3 style="margin-top: 0; text-align: center;">Select APs</h3>
    <div id="apList" style="margin-bottom: 20px;"></div>
  </div>
  <button id="confirmApBtn" onclick="addSelectedAps()" style="display: none;">Confirm Selection</button>

</body>
</html>
